 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Network Inspector</title>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('ca63eccfcf11bcd02c1a900196de630f_720w.mp4') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      color: #333;
      overflow-x: hidden;
    }

    header, footer {
      background: #000000;
      color: rgb(0, 255, 42);
      text-align: center;
      padding: 20px 10px;
      box-shadow: 0 0 20px rgba(0,255,42,0.3);
    }

    main {
      display: flex;
      flex-wrap: wrap;
      padding: 20px;
      gap: 20px;
      justify-content: space-around;
    }

    section {
      background: rgba(255,255,255,0.95);
      padding: 20px;
      border-radius: 8px;
      flex: 1 1 45%;
      box-shadow: 0 4px 20px rgba(0,255,42,0.2);
      border: 1px solid rgba(0,255,42,0.3);
    }

    #network {
      width: 100%;
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    #log-container {
      height: 400px;
      overflow-y: auto;
      background: #000;
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      border: 1px solid #333;
      border-radius: 4px;
    }

    #device-list {
      list-style: none;
      padding-left: 0;
      font-family: monospace;
      font-size: 14px;
      max-height: 400px;
      overflow-y: auto;
    }

    .device {
      margin: 4px 0;
      border-bottom: 1px dashed #ccc;
      padding: 5px;
      transition: all 0.3s;
    }

    .device:hover {
      background: rgba(0,255,42,0.1);
    }

    .vuln {
      color: red;
      font-weight: bold;
    }

    button {
      margin-bottom: 10px;
      padding: 6px 12px;
      background: #ff0000;
      color: rgb(0, 255, 85);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    button:hover {
      background: #cc0000;
      box-shadow: 0 0 10px rgba(255,0,0,0.5);
    }

    button:disabled {
      background: #666;
      cursor: not-allowed;
    }

    h1, h2 {
      text-shadow: 0 0 10px rgba(0,255,42,0.5);
    }
  </style>
</head>
<body>
  <header>
    <h1>üîç Network Inspector Dashboard</h1>
    <p>Real-time Network Analysis & Security Monitoring | Powered by Vercel</p>
  </header>

  <main>
    <section>
      <h2>üì° Connected Devices</h2>
      <button id="scanBtn" onclick="fetchDevices()">üîÑ Scan Network</button>
      <ul id="device-list">
        <li>Click "Scan Network" to discover devices...</li>
      </ul>
    </section>

    <section>
      <h2>üìä Live Network Activity</h2>
      <div id="log-container">[ Initializing Network Inspector... ]</div>
    </section>

    <section>
      <h2>üåê Network Topology</h2>
      <div id="network">Scan network to visualize topology</div>
    </section>

    <section>
      <h2>üì∂ Current Connection</h2>
      <div id="wifi-info">Loading...</div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 Network Inspector | Real Backend Scanning</p>
  </footer>

  <script>
    const logContainer = document.getElementById("log-container");
    const deviceList = document.getElementById("device-list");
    const wifiInfo = document.getElementById("wifi-info");
    const networkDiv = document.getElementById("network");
    let scanning = false;

    // Log function
    function log(message) {
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement("div");
      entry.textContent = `[${time}] ${message}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    // Real network scan
    async function fetchDevices() {
      if (scanning) return;
      scanning = true;
      const btn = document.getElementById("scanBtn");
      btn.textContent = "‚è≥ Scanning...";
      btn.disabled = true;
      
      log("üöÄ Starting real network scan...");
      
      try {
        const response = await fetch('/api/scan');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const data = await response.json();
        displayDevices(data.devices);
        drawTopology(data.topology.nodes, data.topology.edges);
        log(`‚úÖ Scan complete: ${data.devices.length} devices discovered`);
      } catch (error) {
        log(`‚ùå Scan failed: ${error.message}`);
        deviceList.innerHTML = '<li style="color:red;">Scan failed - check backend</li>';
      } finally {
        btn.textContent = "üîÑ Scan Network";
        btn.disabled = false;
        scanning = false;
      }
    }

    // Display real devices
    function displayDevices(devices) {
      deviceList.innerHTML = "";
      devices.forEach(device => {
        const li = document.createElement("li");
        li.className = "device";
        li.innerHTML = `
          <strong>${device.ip}</strong><br>
          MAC: ${device.mac}<br>
          Vendor: ${device.vendor}
          ${device.openPorts?.length ? `<span class="vuln"> ‚ö†Ô∏è Open ports detected</span>` : ''}
        `;
        deviceList.appendChild(li);
      });
    }

    // Real topology visualization
    function drawTopology(nodes, edges) {
      const data = { 
        nodes: new vis.DataSet(nodes), 
        edges: new vis.DataSet(edges) 
      };
      const options = {
        nodes: {
          shape: "dot",
          color: { background: "#007bff", border: "#ffffff" },
          font: { color: "white", size: 12 },
          size: 20
        },
        edges: {
          arrows: 'to',
          color: "#00ff42",
          width: 2,
          smooth: false
        },
        physics: { 
          enabled: true, 
          stabilization: { iterations: 100 },
          barnesHut: { gravitationalConstant: -8000 }
        }
      };
      new vis.Network(networkDiv, data, options);
    }

    // Live packet streaming
    async function streamPackets() {
      try {
        const response = await fetch('/api/packets');
        const packets = await response.text();
        logContainer.innerHTML += packets;
        logContainer.scrollTop = logContainer.scrollHeight;
      } catch(e) {
        // Silent fail for packet stream
      }
    }

    // Network info
    function displayWifiInfo() {
      if (navigator.connection) {
        const conn = navigator.connection;
        wifiInfo.innerHTML = `
          <strong>üîó Type:</strong> ${conn.effectiveType}<br>
          <strong>üì° Speed:</strong> ${conn.downlink} Mbps<br>
          <strong>‚è±Ô∏è RTT:</strong> ${conn.rtt} ms<br>
          <strong>üíæ SaveData:</strong> ${conn.saveData ? "Enabled" : "Disabled"}
        `;
      } else {
        wifiInfo.innerHTML = "Network APIs unavailable";
      }
    }

    // Initialize
    log("üîå Network Inspector loaded");
    displayWifiInfo();
    
    // Auto-refresh
    setInterval(displayWifiInfo, 5000);
    setInterval(streamPackets, 3000);
  </script>
</body>
</html>
